rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Helper functions
    function isAuth() {
      return request.auth != null;
    }
    
    function isValidTeam() {
      return request.resource.data.name is string &&
             request.resource.data.name.size() > 0 &&
             request.resource.data.sport in ['Football', 'Basketball', 'Volleyball', 'Cricket', 'Throwball', 
                                         'Badminton (Singles)', 'Badminton (Doubles)', 
                                         'Table Tennis (Singles)', 'Table Tennis (Doubles)', 'Kabaddi'];
    }
    
    function isValidMatch() {
      return request.resource.data.teamAId is string &&
             request.resource.data.teamBId is string &&
             request.resource.data.sport in ['Football', 'Basketball', 'Volleyball', 'Cricket', 'Throwball', 
                                         'Badminton (Singles)', 'Badminton (Doubles)', 
                                         'Table Tennis (Singles)', 'Table Tennis (Doubles)', 'Kabaddi'] &&
             request.resource.data.status in ['UPCOMING', 'LIVE', 'COMPLETED'] &&
             request.resource.data.startTime is string &&
             request.resource.data.venue is string;
    }

    // Players collection - Public read, authenticated write
    match /players/{playerId} {
      allow read: if true;  // Anyone can read player data
      allow create: if isAuth() && 
                     request.resource.data.name is string &&
                     request.resource.data.name.size() > 0 &&
                     request.resource.data.teamId is string;
      allow update, delete: if isAuth();  // Authenticated users can modify
    }

    // Users collection - Only owner or admin can access
    match /users/{userId} {
      allow read, write: if isAuth() && request.auth.uid == userId;
    }
    
    // Matches collection - Public read, authenticated write
    match /matches/{matchId} {
      allow read: if true;  // Anyone can read match data
      allow create: if isAuth() && isValidMatch();
      allow update: if isAuth();  // Authenticated users can update
      allow delete: if isAuth();  // Authenticated users can delete
    }
    
    // Teams collection - Public read, authenticated write
    match /teams/{teamId} {
      allow read: if true;  // Anyone can read team data
      allow create: if isAuth() && isValidTeam();
      allow update: if isAuth() && isValidTeam();
      allow delete: if isAuth();  // Authenticated users can delete
    }
  }
}
